<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pomodoro com YouTube √Åudio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .theme-light {
      --bg: #ffffff;
      --text: #1f2937;
      --card: #f3f4f6;
      --button: #3b82f6;
      --button-hover: #2563eb;
    }
    .theme-dark {
      --bg: #111827;
      --text: #f9fafb;
      --card: #1f2937;
      --button: #6366f1;
      --button-hover: #4f46e5;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      transition: all 0.3s ease;
    }
    .card { background-color: var(--card); transition: background-color 0.3s ease; }
    .btn { background-color: var(--button); color: white; }
    .btn:hover { background-color: var(--button-hover); }
  </style>
</head>
<body class="theme-light font-sans min-h-screen flex flex-col items-center justify-center p-4">

  <button id="themeToggle" class="absolute top-4 right-4 p-2 rounded-full btn">üåô</button>

  <div class="card p-8 rounded-xl shadow-md w-full max-w-md text-center">
    <h1 class="text-3xl font-bold mb-4">Pomodoro Timer</h1>
    <div class="flex items-center justify-center gap-2 mb-6">
      <div id="timer" class="text-6xl font-mono">25:00</div>
      <button id="editDuration" class="text-xl" title="Editar Dura√ß√£o">‚úèÔ∏è</button>
    </div>

    <div class="flex justify-center space-x-4 mb-4">
      <button id="start" class="btn px-4 py-2 rounded-lg">Iniciar</button>
      <button id="pause" class="btn px-4 py-2 rounded-lg">Pausar</button>
      <button id="reset" class="btn px-4 py-2 rounded-lg">Zerar</button>
    </div>

    <!-- YouTube Audio Player -->
    <div class="mt-4">
      <input id="youtubeLink" type="text" placeholder="Cole o link do YouTube" class="px-4 py-2 rounded w-full mb-2 text-black">
      <button id="loadAudio" class="btn w-full mb-2 py-2 rounded">üéµ Carregar √Åudio</button>
      <div class="flex justify-center gap-2">
        <button id="playAudio" class="btn px-4 py-1 rounded">‚ñ∂Ô∏è</button>
        <button id="pauseAudio" class="btn px-4 py-1 rounded">‚è∏Ô∏è</button>
        <button id="repeatAudio" class="btn px-4 py-1 rounded">üîÅ</button>
        <button id="skipAd" class="btn px-4 py-1 rounded hidden">‚è≠ Pular An√∫ncio</button>
      </div>
      <div id="player"></div>
    </div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // Altern√¢ncia de Tema
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    themeToggle.addEventListener('click', () => {
      const isLight = body.classList.contains('theme-light');
      body.classList.toggle('theme-light', !isLight);
      body.classList.toggle('theme-dark', isLight);
      themeToggle.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
    });

    // Timer Pomodoro
    let duration = 25 * 60;
    let timeLeft = duration;
    let interval = null;

    const timerDisplay = document.getElementById('timer');
    const startBtn = document.getElementById('start');
    const pauseBtn = document.getElementById('pause');
    const resetBtn = document.getElementById('reset');
    const editBtn = document.getElementById('editDuration');

    function updateTimer() {
      const min = String(Math.floor(timeLeft / 60)).padStart(2, '0');
      const sec = String(timeLeft % 60).padStart(2, '0');
      timerDisplay.textContent = `${min}:${sec}`;
    }

    function startTimer() {
      if (interval) return;
      interval = setInterval(() => {
        if (timeLeft > 0) {
          timeLeft--;
          updateTimer();
        } else {
          clearInterval(interval);
          interval = null;
        }
      }, 1000);
    }

    function pauseTimer() {
      clearInterval(interval);
      interval = null;
    }

    function resetTimer() {
      pauseTimer();
      timeLeft = duration;
      updateTimer();
    }

    editBtn.addEventListener('click', () => {
      const input = prompt("Digite a nova dura√ß√£o em minutos:", "25");
      if (!isNaN(input) && input > 0) {
        duration = parseInt(input) * 60;
        timeLeft = duration;
        updateTimer();
      }
    });

    startBtn.addEventListener('click', startTimer);
    pauseBtn.addEventListener('click', pauseTimer);
    resetBtn.addEventListener('click', resetTimer);
    updateTimer();

    // YouTube IFrame API
    let player;
    let isRepeat = false;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '0',
        width: '0',
        videoId: '',
        events: {
          'onStateChange': onPlayerStateChange
        },
        playerVars: {
          autoplay: 0,
          controls: 0
        }
      });
    }

    function onPlayerStateChange(event) {
      const skipAdBtn = document.getElementById('skipAd');
      if (event.data === 1 || event.data === 3) {
        skipAdBtn.classList.remove('hidden');
      } else {
        skipAdBtn.classList.add('hidden');
      }

      if (event.data === YT.PlayerState.ENDED && isRepeat) {
        player.seekTo(0);
        player.playVideo();
      }
    }

    document.getElementById('loadAudio').addEventListener('click', () => {
      const link = document.getElementById('youtubeLink').value.trim();
      const match = link.match(/[?&]v=([^&]+)/);
      if (match && match[1]) {
        const videoId = match[1];
        if (player && player.loadVideoById) {
          player.loadVideoById(videoId);
          player.setVolume(100);
        } else {
          player = new YT.Player('player', {
            height: '0',
            width: '0',
            videoId: videoId,
            events: { 'onStateChange': onPlayerStateChange },
            playerVars: { autoplay: 1, controls: 0 }
          });
        }
      }
    });

    document.getElementById('playAudio').addEventListener('click', () => {
      if (player && player.playVideo) player.playVideo();
    });

    document.getElementById('pauseAudio').addEventListener('click', () => {
      if (player && player.pauseVideo) player.pauseVideo();
    });

    document.getElementById('repeatAudio').addEventListener('click', () => {
      isRepeat = !isRepeat;
      document.getElementById('repeatAudio').classList.toggle('ring-2', isRepeat);
    });

    document.getElementById('skipAd').addEventListener('click', () => {
      if (player && player.getDuration) {
        const total = player.getDuration();
        player.seekTo(total - 2);
      }
    });
  </script>
</body>
</html>
