<!DOCTYPE html>
<html lang="pt-BR" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pomodoro com YouTube Áudio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Temas Light / Dark */
    .theme-light {
      --bg: #ffffff;
      --text: #1f2937;
      --card: #f3f4f6;
      --button: #3b82f6;
      --button-hover: #2563eb;
    }
    .theme-dark {
      --bg: #111827;
      --text: #f9fafb;
      --card: #1f2937;
      --button: #6366f1;
      --button-hover: #4f46e5;
    }
    body {
      background-color: var(--bg);
      color: var(--text);
      transition: all 0.3s ease;
    }
    .card {
      background-color: var(--card);
      transition: background-color 0.3s ease;
    }
    .btn {
      background-color: var(--button);
      color: white;
      transition: background-color 0.2s ease;
    }
    .btn:hover {
      background-color: var(--button-hover);
    }
  </style>
</head>
<body class="font-sans min-h-screen flex flex-col items-center justify-center p-4">

  <button id="themeToggle" class="absolute top-4 right-4 p-2 rounded-full btn" aria-label="Toggle Tema">🌙</button>

  <div class="card p-8 rounded-xl shadow-md w-full max-w-md text-center">
    <h1 class="text-3xl font-bold mb-4">Pomodoro Timer</h1>
    <div class="flex justify-center items-center gap-2 mb-4">
      <div id="timer" class="text-6xl font-mono select-none" aria-live="polite">25:00</div>
      <button id="editTime" class="btn p-2 rounded-full" aria-label="Editar duração do timer">✏️</button>
    </div>

    <div class="flex justify-center space-x-4 mb-4">
      <button id="start" class="btn px-4 py-2 rounded-lg">Iniciar</button>
      <button id="pause" class="btn px-4 py-2 rounded-lg">Pausar</button>
      <button id="reset" class="btn px-4 py-2 rounded-lg">Zerar</button>
    </div>

    <button id="toggleAudioPlayer" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 rounded-lg mb-4" aria-expanded="false" aria-controls="audioPlayerContainer" aria-label="Mostrar/Ocultar player de áudio">
      🎵 Adicionar Áudio
    </button>

    <div id="audioPlayerContainer" class="hidden w-full max-w-md p-4 bg-white dark:bg-gray-800 rounded-lg shadow" aria-hidden="true">
      <div class="flex items-center space-x-2 mb-4">
        <input
          type="text"
          id="youtubeLink"
          placeholder="Cole o link do YouTube"
          class="flex-1 px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 text-black dark:text-white"
          aria-label="Link do vídeo do YouTube"
        />
        <button id="loadAudio" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" aria-label="Carregar áudio">Carregar</button>
      </div>

      <div id="player" style="width:0; height:0; visibility:hidden; position:absolute;"></div>

      <div class="flex gap-2 justify-center">
        <button id="playAudio" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700" aria-label="Tocar áudio">▶️ Play</button>
        <button id="pauseAudio" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700" aria-label="Pausar áudio">⏸️ Pause</button>
        <button id="skipAd" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 hidden" aria-label="Pular anúncio">⏭ Pular Anúncio</button>
        <button id="repeatToggle" class="px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600" aria-pressed="false" aria-label="Alternar repetição">
          🔁 Repetir
        </button>
      </div>
    </div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // --- Tema ---
    const themeToggle = document.getElementById("themeToggle");
    const body = document.body;

    // Inicializa tema a partir do localStorage ou preferencia sistema
    const savedTheme = localStorage.getItem("theme");
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
      body.classList.add("theme-dark");
      themeToggle.textContent = "☀️";
    } else {
      body.classList.add("theme-light");
      themeToggle.textContent = "🌙";
    }

    themeToggle.addEventListener("click", () => {
      const isDark = body.classList.toggle("theme-dark");
      body.classList.toggle("theme-light", !isDark);
      themeToggle.textContent = isDark ? "☀️" : "🌙";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });

    // --- Timer Pomodoro ---
    let duration = 25 * 60;
    let timeLeft = duration;
    let interval = null;

    const timerDisplay = document.getElementById("timer");
    const startBtn = document.getElementById("start");
    const pauseBtn = document.getElementById("pause");
    const resetBtn = document.getElementById("reset");
    const editBtn = document.getElementById("editTime");

    function updateTimer() {
      const min = String(Math.floor(timeLeft / 60)).padStart(2, "0");
      const sec = String(timeLeft % 60).padStart(2, "0");
      timerDisplay.textContent = `${min}:${sec}`;
    }

    function startTimer() {
      if (interval) return;
      interval = setInterval(() => {
        if (timeLeft > 0) {
          timeLeft--;
          updateTimer();
        } else {
          clearInterval(interval);
          interval = null;
          // Aqui você pode adicionar som ou notificação que o timer terminou
        }
      }, 1000);
    }

    function pauseTimer() {
      clearInterval(interval);
      interval = null;
    }

    function resetTimer() {
      pauseTimer();
      timeLeft = duration;
      updateTimer();
    }

    function editDuration() {
      const input = prompt("Digite a duração em minutos (1-180):", Math.floor(duration / 60));
      const num = Number(input);
      if (!isNaN(num) && num >= 1 && num <= 180) {
        duration = num * 60;
        timeLeft = duration;
        updateTimer();
      } else if(input !== null) {
        alert("Valor inválido. Informe um número entre 1 e 180.");
      }
    }

    startBtn.addEventListener("click", startTimer);
    pauseBtn.addEventListener("click", pauseTimer);
    resetBtn.addEventListener("click", resetTimer);
    editBtn.addEventListener("click", editDuration);
    updateTimer();

    // --- Player YouTube ---
    let player;
    let repeatMode = false;

    const toggleAudioPlayerBtn = document.getElementById("toggleAudioPlayer");
    const audioPlayerContainer = document.getElementById("audioPlayerContainer");
    const loadAudioBtn = document.getElementById("loadAudio");
    const youtubeLinkInput = document.getElementById("youtubeLink");
    const playAudioBtn = document.getElementById("playAudio");
    const pauseAudioBtn = document.getElementById("pauseAudio");
    const skipAdBtn = document.getElementById("skipAd");
    const repeatToggleBtn = document.getElementById("repeatToggle");

    toggleAudioPlayerBtn.addEventListener("click", () => {
      const isHidden = audioPlayerContainer.classList.toggle("hidden");
      toggleAudioPlayerBtn.setAttribute("aria-expanded", !isHidden);
    });

    function extractVideoID(url) {
      // Pega o id de links youtube do tipo ?v=xxxx ou youtu.be/xxxx
      const regex = /(?:youtube\.com\/.*v=|youtu\.be\/)([^&\n?#]+)/;
      const match = url.match(regex);
      return match ? match[1] : null;
    }

    function createOrLoadPlayer(videoId) {
      if (player) {
        player.loadVideoById(videoId);
      } else {
        player = new YT.Player("player", {
          height: "0",
          width: "0",
          videoId: videoId,
          events: {
            onReady: () => {
              player.playVideo();
              skipAdBtn.classList.remove("hidden");
            },
            onStateChange: (event) => {
              if (event.data === YT.PlayerState.ENDED && repeatMode) {
                player.seekTo(0);
                player.playVideo();
              }
            },
          },
          playerVars: {
            autoplay: 1,
            controls: 0,
            disablekb: 1,
            modestbranding: 1,
            rel: 0,
          },
        });
      }
    }

    loadAudioBtn.addEventListener("click", () => {
      const url = youtubeLinkInput.value.trim();
      const videoId = extractVideoID(url);
      if (videoId) {
        createOrLoadPlayer(videoId);
      } else {
        alert("Link do YouTube inválido.");
      }
    });

    playAudioBtn.addEventListener("click", () => {
      if (player && typeof player.playVideo === "function") {
        player.playVideo();
      }
    });

    pauseAudioBtn.addEventListener("click", () => {
      if (player && typeof player.pauseVideo === "function") {
        player.pauseVideo();
      }
    });

    skipAdBtn.addEventListener("click", () => {
      if (player && typeof player.seekTo === "function" && typeof player.getCurrentTime === "function") {
        const currentTime = player.getCurrentTime();
        player.seekTo(currentTime + 5, true);
      }
    });

    repeatToggleBtn.addEventListener("click", () => {
      repeatMode = !repeatMode;
      repeatToggleBtn.textContent = repeatMode ? "🔂 Repetindo" : "🔁 Repetir";
      repeatToggleBtn.setAttribute("aria-pressed", repeatMode);
      repeatToggleBtn.classList.toggle("bg-pink-700", repeatMode);
    });

  </script>
</body>
</html>
